<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  html, body { margin:0; background:transparent; overflow:hidden; }
  * { box-sizing:border-box; }

  :root{
    --bottom: 120px;

    --heart-h: 260px;
    --heart-scale: 1;

    --title-size: 56px;
    --name-size: 46px;

    --page-ms: 6000ms;
    --fade-ms: 1000ms;

    --carpet-w: 860px;
    --stage-w: 1080px;

    --carpet-h: 110px;
    --carpet-radius: 40px;

    --pad-left: 28px;
    --pad-right: 28px;

    --overlap: 25px;
    --icon-nudge-right: 15px;

    --title-offset: 50px;
    --gold: #D4AF37;
  }

  @font-face{
    font-family: "OverlayFont";
    src: url("./images/Poppins-BlackItalic.ttf") format("truetype");
    font-weight: 900;
    font-style: italic;
    font-display: swap;
  }

  #wrap{
    position: fixed;
    left:0; right:0;
    bottom: var(--bottom);
    display:flex;
    justify-content:center;
    pointer-events:none;
  }

  #frame{
    position: relative;
    width: min(1080px, 100vw);
    height: max(var(--heart-h), var(--carpet-h));
  }

  #title{
    position: absolute;
    left: 0;
    top: 0;
    transform: translate3d(0, calc(-1 * var(--title-offset)), 0);

    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: var(--title-size);
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    white-space: nowrap;
    z-index: 2;
  }

  #stage{
    position: absolute;
    left: 0;
    top: 0;
    width: var(--stage-w);
    height: 100%;
  }

  #rotator{
    position: relative;
    width: 100%;
    height: 100%;
    transition: opacity var(--fade-ms) linear;
  }
  #rotator.out{ opacity:0; }

  #carpet{
    position: absolute;
    left: 0;
    top: 50%;
    transform: translate3d(0, -50%, 0);
    width: var(--carpet-w);
    height: var(--carpet-h);
    border-radius: var(--carpet-radius);

    background: linear-gradient(
      180deg,
      #7a0f1f 0%,
      #5a0c17 45%,
      #3d0810 100%
    );
    border: 4.5px solid var(--gold);

    box-shadow:
      0 0 22px rgba(120, 0, 40, 0.45),
      0 0 60px rgba(60, 0, 20, 0.35);
  }

  #name{
    position: absolute;
    left: var(--pad-left);
    top: 50%;
    transform: translate3d(0, -50%, 0);
    height: var(--carpet-h);
    display:flex;
    align-items:center;

    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: var(--name-size);
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);

    white-space: nowrap;
    overflow: hidden;
    z-index: 4;
  }

  #scanner{
    position: absolute;
    top: 50%;
    transform: translate3d(0, -50%, 0);
    z-index: 5;
    pointer-events:none;
  }

  #heart{
    height: calc(var(--heart-h) * var(--heart-scale));
    width: auto;
    display:block;
  }

  #measure{
    position:absolute;
    left:-99999px;
    top:-99999px;
    visibility:hidden;
    white-space:nowrap;
    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: var(--name-size);
    letter-spacing: 2px;
    text-transform: uppercase;
  }
</style>
</head>

<body>
  <div id="wrap">
    <div id="frame">
      <div id="title">TOP MEMBERS</div>

      <div id="stage">
        <div id="rotator">
          <div id="carpet"></div>
          <div id="name">POPEVA - 46</div>
          <div id="scanner">
            <img id="heart" src="images/top.png" alt="icon">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="measure"></div>

<script>
  const PAGE_MS = 6000;
  const FADE_MS = 1000;

  const pages = [
    { img: "images/top.png", text: "POPEVA - 46" },
    { img: "images/mid.png", text: "SALVIOR - 37" },
    { img: "images/mid.png", text: "GHOST RIDER - 34" },
    { img: "images/mid.png", text: "LINIQ - 30" },
    { img: "images/low.png", text: "VLADI13_12 - 29" },
    { img: "images/low.png", text: "OBERON - 28" }
  ];

  const rotator = document.getElementById("rotator");
  const heart   = document.getElementById("heart");
  const nameEl  = document.getElementById("name");
  const scanner = document.getElementById("scanner");
  const meas    = document.getElementById("measure");

  const css = document.documentElement.style;
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  function pxVar(name){
    const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    return parseFloat(v) || 0;
  }

  function scaleFor(src){
    const TOP = 1.05;
    const MID = TOP * 0.80;
    const LOW = MID * 0.85;
    const s = src.toLowerCase();
    if (s.includes("top.png")) return TOP;
    if (s.includes("mid.png")) return MID;
    if (s.includes("low.png")) return LOW;
    return 1;
  }

  async function getImageNatural(path){
    return new Promise(res=>{
      const img = new Image();
      img.onload = () => res({ w: img.naturalWidth || 1, h: img.naturalHeight || 1 });
      img.onerror = () => res({ w: 1, h: 1 });
      img.src = path;
    });
  }

  function textWidth(text){
    meas.textContent = text;
    return Math.ceil(meas.getBoundingClientRect().width);
  }

  async function computeSizes(){
    if (document.fonts && document.fonts.ready) await document.fonts.ready;

    const padLeft  = pxVar("--pad-left");
    const padRight = pxVar("--pad-right");
    const heartH   = pxVar("--heart-h");
    const nudgeR   = pxVar("--icon-nudge-right");

    let maxTextW = 0;
    for (const p of pages){
      maxTextW = Math.max(maxTextW, textWidth(p.text));
    }

    let maxIconW = 0;
    for (const p of pages){
      const nat = await getImageNatural(p.img);
      const scale = scaleFor(p.img);
      const displayW = nat.w * ((heartH * scale) / nat.h);
      maxIconW = Math.max(maxIconW, displayW);
    }
    maxIconW = Math.ceil(maxIconW);

    const reserved = maxIconW + padRight + nudgeR;
    const carpetW = Math.ceil(padLeft + maxTextW + 50 + reserved);
    const stageW  = Math.ceil(carpetW + maxIconW + nudgeR);

    css.setProperty("--carpet-w", carpetW + "px");
    css.setProperty("--stage-w", stageW + "px");

    nameEl.style.width = Math.max(0, carpetW - padLeft - reserved) + "px";
  }

  async function positionIconForCurrent(){
    const nudgeR  = pxVar("--icon-nudge-right");
    const carpetW = pxVar("--carpet-w");
    const heartH  = pxVar("--heart-h");

    const scale = scaleFor(heart.src);
    css.setProperty("--heart-scale", String(scale));

    const nat = await getImageNatural(heart.src);
    const curW = Math.ceil(nat.w * ((heartH * scale) / nat.h));

    /* ðŸ”¥ ONLY CHANGE: push PNGs a bit more right to fully cover carpet edge */
    const COVER = 18;
    const left = Math.ceil(carpetW - curW + nudgeR + COVER);

    scanner.style.left = left + "px";
  }

  async function setHeart(src){
    return new Promise(res=>{
      heart.onload = res; heart.onerror = res;
      heart.src = src;
      if (heart.decode) heart.decode().then(res).catch(()=>{});
    });
  }

  async function showPage(p){
    nameEl.textContent = p.text;
    await setHeart(p.img);
    await positionIconForCurrent();
    rotator.classList.remove("out");
    await sleep(PAGE_MS);
  }

  let idx = 0;

  async function cycle(){
    await computeSizes();
    await positionIconForCurrent();

    while(true){
      await showPage(pages[idx]);
      rotator.classList.add("out");
      await sleep(FADE_MS);
      idx = (idx + 1) % pages.length;
    }
  }

  window.addEventListener("resize", async ()=>{
    await computeSizes();
    await positionIconForCurrent();
  }, { passive:true });

  cycle();
</script>
</body>
</html>
