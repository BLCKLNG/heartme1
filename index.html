<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  html, body { margin:0; background:transparent; overflow:hidden; }
  * { box-sizing:border-box; }

  :root{
    --bottom: 120px;

    --heart-h: 260px;
    --heart-scale: 1;

    --title-size: 56px;
    --name-size: 46px;

    --page-ms: 5000ms;
    --scan-ms: 2000ms;
    --fade-ms: 260ms;

    --carpet-w: 860px;
    --stage-w: 1080px;
    --travel: 600px;

    --carpet-h: 110px;
    --carpet-radius: 26px;

    --pad-left: 28px;

    --title-offset: 50px;
  }

  @font-face{
    font-family: "OverlayFont";
    src: url("./images/Poppins-BlackItalic.ttf") format("truetype");
    font-weight: 900;
    font-style: italic;
    font-display: swap;
  }

  #wrap{
    position: fixed;
    left:0; right:0;
    bottom: var(--bottom);
    display:flex;
    justify-content:center;
    pointer-events:none;
  }

  /* ✅ FIX: constant height so nothing shifts when heart-scale changes */
  #frame{
    position: relative;
    width: min(1080px, 100vw);
    height: max(var(--heart-h), var(--carpet-h));
  }

  #title{
    position: absolute;
    left: 0;
    top: 0;
    transform: translate3d(0, calc(-1 * var(--title-offset)), 0);

    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: var(--title-size);
    letter-spacing: 3px;
    text-transform: uppercase;
    color: #D4AF37;
    white-space: nowrap;
    z-index: 2;
  }

  /* ✅ stage pinned to frame-left; height fixed via frame */
  #stage{
    position: absolute;
    left: 0;
    top: 0;
    width: var(--stage-w);
    height: 100%;
  }

  #rotator{
    position: relative;
    width: 100%;
    height: 100%;
    transition: opacity var(--fade-ms) linear;
  }
  #rotator.out{ opacity:0; }

  #carpet{
    position: absolute;
    left: 0;
    top: 50%;
    transform: translate3d(0, -50%, 0);
    width: var(--carpet-w);
    height: var(--carpet-h);
    border-radius: var(--carpet-radius);

    background: linear-gradient(
      180deg,
      rgba(255, 40, 40, 0.95) 0%,
      rgba(220, 0, 0, 0.95) 45%,
      rgba(140, 0, 0, 0.95) 100%
    );

    box-shadow:
      0 0 18px rgba(255, 0, 0, 0.55),
      0 0 36px rgba(255, 0, 0, 0.35);

    clip-path: inset(0 100% 0 0 round var(--carpet-radius));
  }

  #name{
    position: absolute;
    left: var(--pad-left);
    top: 50%;
    transform: translate3d(0, -50%, 0);
    height: var(--carpet-h);
    display:flex;
    align-items:center;

    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    font-size: var(--name-size);
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #D4AF37;

    width: calc(var(--carpet-w) - var(--pad-left));
    clip-path: inset(0 100% 0 0 round var(--carpet-radius));
    white-space: nowrap;
  }

  #scanner{
    position: absolute;
    left: 0;
    top: 50%;
    transform: translate3d(0, -50%, 0);
    z-index: 5;
  }

  #heart{
    height: calc(var(--heart-h) * var(--heart-scale));
    width: auto;
    display:block;
  }

  .scan #scanner{ animation: scanMove var(--scan-ms) linear forwards; }
  .scan #carpet,
  .scan #name{ animation: revealClip var(--scan-ms) linear forwards; }

  @keyframes scanMove{
    from { transform: translate3d(0, -50%, 0); }
    to   { transform: translate3d(var(--travel), -50%, 0); }
  }

  @keyframes revealClip{
    from { clip-path: inset(0 100% 0 0 round var(--carpet-radius)); }
    to   { clip-path: inset(0 0% 0 0 round var(--carpet-radius)); }
  }

  #measure{
    position:absolute;
    left:-99999px;
    top:-99999px;
    visibility:hidden;
    white-space:nowrap;
    font-size: var(--name-size);
    font-family: "OverlayFont","Segoe UI",Arial,sans-serif;
    font-weight: 900;
    font-style: italic;
    letter-spacing: 2px;
    text-transform: uppercase;
  }
</style>
</head>

<body>
  <div id="wrap">
    <div id="frame">
      <div id="title">TOP MEMBERS</div>

      <div id="stage">
        <div id="rotator">
          <div id="carpet"></div>
          <div id="name">POPEVA - 46</div>
          <div id="scanner">
            <img id="heart" src="images/top.png" alt="scanner">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="measure"></div>

<script>
  const PAGE_MS = 5000, SCAN_MS = 2000, FADE_MS = 260;

  const pages = [
    { img: "images/top.png", text: "POPEVA - 46" },
    { img: "images/mid.png", text: "SALVIOR - 37" },
    { img: "images/mid.png", text: "GHOST RIDER - 34" },
    { img: "images/mid.png", text: "LINIQ - 30" },
    { img: "images/low.png", text: "VLADI13_12 - 29" },
    { img: "images/low.png", text: "OBERON - 28" }
  ];

  const frame   = document.getElementById("frame"),
        rotator = document.getElementById("rotator"),
        heart   = document.getElementById("heart"),
        nameEl  = document.getElementById("name"),
        meas    = document.getElementById("measure");

  let idx = 0;
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  function setScale(src){
    document.documentElement.style.setProperty(
      "--heart-scale",
      (src.includes("mid.png") || src.includes("low.png")) ? "0.6" : "1"
    );
  }

  function setHeart(path){
    return new Promise(res=>{
      setScale(path);
      heart.onload=res; heart.onerror=res;
      heart.src = path;
      if (heart.decode) heart.decode().then(res).catch(()=>{});
    });
  }

  function resetScan(){ rotator.classList.remove("scan"); void rotator.offsetWidth; }
  function startScan(){ rotator.classList.add("scan"); }
  function clamp(n,lo,hi){ return Math.max(lo,Math.min(hi,n)); }

  function computeGeometry(text){
    const afterTextPx = 50;
    const overlapPx = 20; // (your current overlap after moving heart right 20px)

    const frameW = Math.ceil(frame.getBoundingClientRect().width);

    meas.textContent = text;
    const textW = Math.ceil(meas.getBoundingClientRect().width);

    const padLeft = 28;
    const heartW = Math.ceil(heart.getBoundingClientRect().width) || 220;

    let carpetW = padLeft + textW + afterTextPx;

    const maxCarpetW = Math.max(240, frameW - heartW + overlapPx);
    carpetW = clamp(carpetW, 240, maxCarpetW);

    const stageW = carpetW + heartW - overlapPx;
    const travel = carpetW - overlapPx;

    document.documentElement.style.setProperty("--carpet-w", carpetW + "px");
    document.documentElement.style.setProperty("--stage-w", stageW + "px");
    document.documentElement.style.setProperty("--travel", travel + "px");
  }

  async function showPage(p){
    nameEl.textContent = p.text;
    await (document.fonts ? document.fonts.ready : Promise.resolve());
    await setHeart(p.img);
    computeGeometry(p.text);
    rotator.classList.remove("out");
    resetScan(); startScan();
    await sleep(PAGE_MS);
  }

  async function cycle(){
    while(true){
      await showPage(pages[idx]);
      rotator.classList.add("out");
      await sleep(FADE_MS);
      idx = (idx + 1) % pages.length;
    }
  }

  window.addEventListener("resize",()=>computeGeometry(pages[idx].text));
  cycle();
</script>
</body>
</html>
